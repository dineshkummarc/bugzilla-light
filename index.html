<!DOCTYPE html>

<meta charset="utf8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="icon" href="favicon.ico"/>

<title>Bugzilla Light</title>

<link rel="stylesheet" href="style.css">

<script>
  var gWorld = {server: "https://api-dev.bugzilla.mozilla.org/latest/",
                connected: false};
</script>

<script src="mustache.js"></script>
<script type="application/javascript;version=1.8" src="utils.js"></script>
<script type="application/javascript;version=1.8" src="date.js"></script>
<script type="application/javascript;version=1.8" src="network.js"></script>
<script type="application/javascript;version=1.8" src="resolver.js"></script>

<header>
  <div class="loginblock">
    <script type="text/html" when="onlogin">
      <div class="ifconnected">
        Logged as: {{username}}<button onclick="UI.logout()">logout</button>
      </div>
    </script>
    <div class="ifnotconnected">
      <form onsubmit="UI.login();return false">
        <input type="email" placeholder="email" id="loginusername">
        <input type="password" placeholder="password" id="loginpassword">
        <input type="submit">
      </form>
    </div>
  </div>
</header>

<section class="bugcontent">
  <script type="text/html" when="onbugmeta" class="meta">
    <h1>{{bug.summary}}</h1>
    <section>
      <p class="caption">Status:</p>
      <dl>
        <dd>{{bug.status}} {{bug.resolution}}
        <dt>Written by:
        <dd class="avatar" style="background-image:url(http://avatars.io/email/{{bug.creator.name}})">{{bug.creator.real_name}}{{^bug.creator.real_name}}{{bug.creator.name}}{{/bug.creator.real_name}}
        <dt>Assigned to:
        <dd class="avatar" style="background-image:url(http://avatars.io/email/{{bug.assigned_to.name}})">{{bug.assigned_to.real_name}}{{^bug.assigned_to.real_name}}{{bug.assigned_to.name}}{{/bug.assigned_to.real_name}}
        <dt>whiteboard:
        <dd><input value="{{bug.whiteboard}}">
        <dt>QA Contact:
        <dd>{{qa_contact.name}}
        <dt>target:
        <dd>
          <span>{{bug.priority}}</span>
          <span>{{bug.severity}}</span>
          <span>{{bug.target_milestone}}</span>
        </dd>
      </dl>
    </section>
    <section>
      <p class="caption">Flags:</p>
      FIXME
    </section>
    <section>
      <p class="caption">Dependencies:</p>
      <dl>
        <dt>Depends on:</dt>
        <dd>
        {{#bug.depends_on}}
          <a class="bug{{.}}" href="#{{.}}">{{.}}</a>
        {{/bug.depends_on}}
        </dd>
      </dl>
      <dl>
        <dt>Blocks:</dt>
        <dd>
        {{#bug.blocks}}
          <a class="bug{{.}}" href="#{{.}}">{{.}}</a>
        {{/bug.blocks}}
        </dd>
      </dl>
    </section>
    <section caption="local notes:">
      <p>
      <textarea id="localnotes" placeholder="local notes are saved in localStorage automatically."></textarea>
      </p>
    </section>
    <section>
      <p class="caption">Affects:</p>
      <dl>
        <dt>Product:</dt>
        <dd>{{bug.product}}
      </dl>

      <dl class="platform">
        <dt>Platform:</dt>
        <dd>{{bug.platform}}
      </dl>
    </section>
    <section class="followers">
      <p class="caption">Followers:</p>
      <ul class="followers">
        {{#bug.cc}}
        <li class="avatar" style="background-image:url(http://avatars.io/email/{{name}})" title='{name}'>{{name}} </li>
        {{/bug.cc}}
      </ul>
    </section>
  </script>
  <script type="text/html" when="oncomments" class="comments">
    {{#comments}}
    <div tabindex="0" class="comment {{mine}}">
      <p class="date">{{prettydate}}<span class="commentcounter"> - #{{counter}}</span></p>
      <p style="background-image: url(http://avatars.io/email/{{creator.name}})" class="author avatar">{{creator.name}}</p>
      <pre class="message">{{{formatedtext}}}</pre>
    </div>
    {{/comments}}
  </script>
</section>

<footer>
  <pre tabindex="0" class="glog"></pre>
  <script type="text/html" when="onload">
    Server: <span class="gserver">{{server}}</span>
  </script>
</footer>

<script type="application/javascript;version=1.8" src="ui.js"></script>
