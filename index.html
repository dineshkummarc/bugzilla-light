<!DOCTYPE html>

<meta charset="utf8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="icon" href="favicon.ico"/>

<title>Bugzilla Light</title>

<link rel="stylesheet" href="style.css">

<script>
  var gWorld = {test: true, bugzillaurl: "https://landfill.bugzilla.org/bzapi_sandbox/",
                connected: false};
</script>

<script src="mustache.js"></script>
<script type="application/javascript;version=1.8" src="utils.js"></script>
<script type="application/javascript;version=1.8" src="date.js"></script>
<script type="application/javascript;version=1.8" src="markdown.js"></script>
<script type="application/javascript;version=1.8" src="bz.js"></script>
<script type="application/javascript;version=1.8" src="resolver.js"></script>
<script type="application/javascript;version=1.8" src="keybindings.js"></script>
<script type="application/javascript;version=1.8" src="updatebug.js"></script>

<header>
  <span class="loginblock">
    <script type="text/html" when="onlogin" tagname="span">
      <span class="ifconnected">
        &lt;{{username}}&gt;<button onclick="UI.logout()">logout</button>
      </span>
    </script>
    <span >
      <form onsubmit="UI.login();return false" class="ifnotconnected">
        <input type="email" placeholder="email" class="loginusername">
        <input type="password" placeholder="password" class="loginpassword">
        <input type="submit">
      </form>
    </div>
  </span>
  <script type="text/html" when="onbugmeta" tagname="span">
    <a href="{{bugzillaurl}}show_bug.cgi?id={{bug.id}}">open in bugzilla</a>
  </script>
</header>

<section class="bugcontent">
  <script type="text/html" when="onbugmeta" classlist="meta">
    <h1>{{bug.alias}} Bug {{bug.id}} - {{bug.summary}}</h1>
    <section>
      <p class="caption">Status:</p>
      <dl>
        <dd class="editable">{{bug.status}} {{bug.resolution}}
        <dt>Written by:
        <dd class="avatar" style="background-image:url(http://avatars.io/email/{{bug.creator.name}})">{{bug.creator.real_name}}{{^bug.creator.real_name}}{{bug.creator.name}}{{/bug.creator.real_name}}
        <dt>Assigned to:
        <dd class="editable avatar" style="background-image:url(http://avatars.io/email/{{bug.assigned_to.name}})">{{bug.assigned_to.real_name}}{{^bug.assigned_to.real_name}}{{bug.assigned_to.name}}{{/bug.assigned_to.real_name}}
        <dt>whiteboard:
        <dd><form onsubmit="gUpdate.whiteboard()"><input id="form-whiteboard" value="{{bug.whiteboard}}"></form>
        <dt>QA Contact:
        <dd>{{bug.qa_contact.name}}
        <dt>target:
        <dd class="separate">
          <span>{{bug.priority}}</span>
          <span>{{bug.severity}}</span>
          <span>{{bug.target_milestone}}</span>
        </dd>
      </dl>
    </section>
    <section>
      <p class="caption">Flags:</p>
      FIXME
    </section>
    <section>
      <p class="caption">Dependencies:</p>
      <dl>
        <dt>Depends on:</dt>
        <dd class="separate">
        {{#bug.depends_on}}
          <a class="bug{{.}}" href="#{{.}}">{{.}}</a>
        {{/bug.depends_on}}
        </dd>
      </dl>
      <dl>
        <dt>Blocks:</dt>
        <dd class="separate">
        {{#bug.blocks}}
          <a class="bug{{.}}" href="#{{.}}">{{.}}</a>
        {{/bug.blocks}}
        </dd>
      </dl>
    </section>
    <section>
      <p class="caption">Local:</p>
      <dl>
        <dt>Notes:</dt>
        <dd><textarea id="localnotes" placeholder="local notes are saved in localStorage automatically."></textarea>
      </dl>
    </section>
    <section>
      <p class="caption">Affects:</p>
      <dl>
        <dt>Product:</dt>
        <dd>{{bug.product}}
      </dl>

      <dl class="platform">
        <dt>Platform:</dt>
        <dd>{{bug.platform}}
      </dl>
    </section>
    <section class="followers">
      <p class="caption">Followers:</p>
      <button class="followbutton" onclick="UI.follow()">follow</button>
      <button class="unfollowbutton" onclick="UI.unfollow()">unfollow</button>
      <ul class="followers">
        {{#bug.cc}}
        <li class="avatar" style="background-image:url(http://avatars.io/email/{{name}})" title='{name}'>{{name}} </li>
        {{/bug.cc}}
      </ul>
    </section>
  </script>
  <script type="text/html" when="oncomments" classlist="comments">
    {{#comments}}
    <div tabindex="0" class="comment {{mine}} {{markdown}}">
      <p class="date">{{prettydate}}<span class="commentcounter"> - #{{counter}}</span></p>
      <p style="background-image: url(http://avatars.io/email/{{creator.name}})" class="author avatar">{{creator.name}}</p>
      <pre class="message">{{{formatedtext}}}</pre>
    </div>
    {{/comments}}
    <div class="addcomment">
      <textarea placeholder="Please, be nice and respectful."></textarea>
      <button onclick="gUpdate.postComment()">Send</button>
    </div>
  </script>
</section>

<script type="application/javascript;version=1.8" src="ui.js"></script>
